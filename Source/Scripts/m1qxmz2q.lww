UIMode = {
    Opening: 0,
    Stage: 1,
    Game: 2,
    Score: 3,
    Ending: 4
};

App = {
    init: function () {
        this.container = document.getElementById("app");

        this.openingUI = new OpeningUI();
        this.openingUI.appendTo(this.container);

        this.stageUI = null;

        this.gameUI = new GameUI();
        this.gameUI.appendTo(this.container);

        this.endingUI = new EndingUI();
        this.endingUI.appendTo(this.container);

        this.tanks = [];

        this.scenes = [this.openingUI, this.gameUI, this.endingUI];
        this.scenesIndex = -1;

        this.mode = UIMode.Opening;
    },
    process: function (src, loaded, total) {
        /*
        console.log(src + " has been loaded");
        */
    },
    complete: function () {

        App.init();

        //this.scoreUI = new ScoreUI();
        //this.scenes = [this.scoreUI];
        //this.scoreUI.appendTo(this.container);
        this.openingUI.enter();
        if (App.scenesIndex == -1) {
            App.scenesIndex = 0;
            App.scenes[0].enter();
        }
        var app = App;
        setInterval(function () {

            if (!app.scenes[app.scenesIndex].update()) {
                app.scenes[app.scenesIndex].level();
                app.scenesIndex++;
                if (app.scenesIndex == app.scenes.length) {
                    app.scenesIndex = 0;
                }
                app.scenes[app.scenesIndex].enter();
            }
            //app.scenes[app.scenesIndex].update();
        }, 16);
    },
    error: function (src, loaded, total) {
        alert("加载图片 " + src + " 出错");
        /*
        console.log(src + " is error");
        */
    },
    run: function () {
        ImageLoader.load(this, ["../Images/Boom.png", "../Images/Frag.png", "../Images/Misc.png", "../Images/Tank.png", "../Images/Terr.png", "../Images/UI.png"]);
    },
    updateFrame: function () {
        setInterval(function () {
            switch (this.mode) {
                case UIMode.Opening:
                    if (!this.openingUI.update()) {
                        this.openingUI.level();
                        this.mode = UIMode.Stage;
                        this.openingUI.enter();
                    }
                    break;
                case UIMode.Stage:
                    if (!this.stageUI.update()) {
                        this.mode = UIMode.Game;
                        this.stageUI.level();
                    }
                    break;
                case UIMode.Game:
                    if (!this.gameUI.update()) {
                        this.mode = UIMode.Score;
                        this.gameUI.level();
                    }
                    break;
                case UIMode.Score:
                    if (!this.scoreUI.update()) {
                        this.mode = this.gameUI.isFailed() ? UIMode.Ending : UIMode.Game;
                        this.scoreUI.level();
                    }
                    break;
                case UIMode.Ending:
                    if (!this.endingUI.update()) {
                        this.mode = UIMode.Opening;
                        this.scoreUI.level();
                    }
                    break;
            }
        });
    }
};